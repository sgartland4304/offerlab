<%# 
  Product Gallery Component for Rails/Tailwind/DaisyUI
  Usage: render partial: 'gallery/gallery', locals: { gallery_media: @gallery_media }
  
  gallery_media format:
  [
    { type: 'image', src: 'assets/image.jpg' },
    { type: 'video', playbackId: 'mux_playback_id', thumbnail: 'optional_thumbnail_url' },
    { type: 'video', src: 'assets/video.mp4', poster: 'assets/poster.jpg' }
  ]
%>

<div class="max-w-[667px] mx-auto my-10 px-6 flex flex-col gap-4 md:px-0 md:p-0">
  <div id="galleryViewport" class="w-full h-[65vh] max-h-[480px] flex items-center justify-center relative overflow-visible md:h-full md:max-h-[45vh] md:overflow-x-auto md:overflow-y-hidden md:snap-x md:snap-mandatory md:absolute md:scroll-px-4 md:[scrollbar-width:none] md:[-ms-overflow-style:none]">
    <div id="galleryTrack" class="w-full h-full relative md:flex md:flex-row md:gap-2.5 md:px-4"></div>
  </div>
  <div class="thumbnail-nav-wrapper flex items-center justify-between gap-2 md:hidden">
    <div id="thumbnails" class="thumbnail-container flex-1 min-w-0 flex gap-1.5 overflow-x-auto py-2 relative scroll-smooth [scrollbar-width:none] [-ms-overflow-style:none]"></div>
    <div class="nav-controls flex gap-2 shrink-0">
      <button id="prevBtn" class="btn btn-circle btn-sm border border-content-border-neutral bg-content-background-elevated shadow-[0_0_2px_0_rgba(0,0,0,0.05),0_4px_6px_0_rgba(0,0,0,0.02)] hover:bg-content-background-base active:scale-95" aria-label="Previous">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" class="w-4 h-4 shrink-0" style="stroke: var(--content-interactive-primary, #342E26);">
          <path d="M9.99984 13.3332L4.6665 7.99985L9.99984 2.6665" stroke="var(--content-interactive-primary, #342E26)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button id="nextBtn" class="btn btn-circle btn-sm border border-content-border-neutral bg-content-background-elevated shadow-[0_0_2px_0_rgba(0,0,0,0.05),0_4px_6px_0_rgba(0,0,0,0.02)] hover:bg-content-background-base active:scale-95" aria-label="Next">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" class="w-4 h-4 shrink-0" style="stroke: var(--content-interactive-primary, #342E26);">
          <path d="M6.00016 2.6665L11.3335 7.99985L6.00016 13.3332" stroke="var(--content-interactive-primary, #342E26)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- Fullscreen Modal using DaisyUI modal structure -->
<div id="fullscreenOverlay" class="fullscreen-overlay fixed inset-0 bg-content-background-base z-[9999] pointer-events-auto hidden items-center justify-center opacity-0 md:p-0">
  <div class="fullscreen-content fixed inset-0 flex m-2 p-3 rounded-[20px] border border-content-border-neutral bg-content-background-elevated overflow-hidden scale-95 opacity-0 md:m-0 md:p-0 md:rounded-none md:border-0 md:shadow-none md:max-w-none md:w-full md:h-full md:gap-0 md:bg-white">
      <button id="fullscreenCloseBtn" class="btn btn-circle btn-sm absolute top-6 right-6 bg-transparent border-0 hover:bg-content-background-base z-[10001] transition-all duration-200 md:top-4 md:right-4 md:bg-content-background-base" aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="var(--content-interactive-primary, #342E26)" stroke-width="2" class="w-5 h-5" style="stroke: var(--content-interactive-primary, #342E26);">
        <path d="M18 6L6 18M6 6l12 12" stroke="var(--content-interactive-primary, #342E26)" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    <div id="fullscreenThumbnails" class="fullscreen-thumbnails z-[1] touch-pan-x ml-6 self-center flex flex-col gap-1.5 overflow-y-auto [scrollbar-width:none] [-ms-overflow-style:none] md:hidden"></div>
    <div id="fullscreenImageContainer" class="fullscreen-image-container flex-1 flex items-center justify-center relative md:p-0"></div>
    <div id="fullscreenNavControls" class="fullscreen-nav-controls absolute bottom-6 right-6 flex gap-2 z-[10001] md:left-1/2 md:right-auto md:-translate-x-1/2 md:justify-center">
      <button id="fullscreenPrevBtn" class="btn btn-circle btn-sm border border-content-border-neutral bg-content-background-elevated shadow-[0_0_2px_0_rgba(0,0,0,0.05),0_4px_6px_0_rgba(0,0,0,0.02)] hover:bg-content-background-base active:scale-95 transition-all duration-200 md:hover:bg-content-background-elevated md:active:bg-content-background-base" aria-label="Previous">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 16 16" fill="none" class="w-4 h-4 shrink-0" style="stroke: var(--content-interactive-primary, #342E26);">
          <path d="M9.99984 13.3332L4.6665 7.99985L9.99984 2.6665" stroke="var(--content-interactive-primary, #342E26)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button id="fullscreenNextBtn" class="btn btn-circle btn-sm border border-content-border-neutral bg-content-background-elevated shadow-[0_0_2px_0_rgba(0,0,0,0.05),0_4px_6px_0_rgba(0,0,0,0.02)] hover:bg-content-background-base active:scale-95 transition-all duration-200 md:hover:bg-content-background-elevated md:active:bg-content-background-base" aria-label="Next">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 16 16" fill="none" class="w-4 h-4 shrink-0" style="stroke: var(--content-interactive-primary, #342E26);">
          <path d="M6.00016 2.6665L11.3335 7.99985L6.00016 13.3332" stroke="var(--content-interactive-primary, #342E26)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<script>
  // Pass gallery media from Rails to JavaScript
  window.galleryMedia = <%= gallery_media.to_json.html_safe %>;
  // Gallery will auto-initialize when gallery.js loads
</script>
<%= javascript_include_tag "gallery", "data-turbo-track": "reload", defer: true %>
